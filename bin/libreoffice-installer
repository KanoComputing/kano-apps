#!/bin/bash

# LibreOffice installer
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# The installer accepts 'uninstall' parameter to remove the application.
# To install, we first check for an internet connection, if there is enough space,
# and finally, if the application is already installed. If all the conditions are met,
# apt-get installs LibreOffice.


if [ "$1" == "uninstall" ]; then
    if [ -n "`dpkg -l 'libreoffice*'`" ]; then
        sudo apt-get purge 'libreoffice*'
    fi
else
    # First we need to check for an internet connection
    is_internet
    if [ $? -ne 0 ]; then
        typewriter_echo 'You need to be connected to the internet to install LibreOffice.' 0 1
    else
	# We need at least 350MB of free space
	FreeSpace=`df -P | grep -v "Available" | awk '{print $4}' | head -n1`
    	if [ $FreeSpace -le 350000 ]; then
            typewriter_echo "You don't have enough available space, ~350MB required." 0 1
            typewriter_echo "Please run Updater in Apps." 0 2
        else
            # Check if libreoffice is already installed
            dpkg -s libreoffice > /dev/null 2> /dev/null
            if [ $? -eq 1 ]; then
                # Install libreoffice
                sudo apt-get install -y --no-install-recommends libreoffice
                if [ $? -eq 0 ]; then
                    # Installed successfully
                    clear
                    typewriter_echo "Congratulations, LibreOffice has been installed successfully." 0 1
                    typewriter_echo "Go to Apps and click on LibreOffice to use it." 0 2
                fi
            else
                typewriter_echo "LibreOffice is already installed in your Kanux system" 0 2
            fi
        fi
    fi
fi

echo -n "Press [ENTER] to continue"
read dummy

nohup kano-apps 2>/dev/null >/dev/null & >/dev/null
sleep 5
