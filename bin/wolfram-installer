#!/bin/bash

# Wolfram installer
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# The installer accepts 'uninstall' parameter to remove the application.
# To install, we first check for an internet connection, if there is enough space,
# and finally, if the application is already installed. If all the conditions are met,
# apt-get installs Wolfram Engine.


if [ "$1" == "uninstall" ]; then
    if [ -z "`dpkg -l 'wolfram-engine'`" ]; then
        sudo apt-get purge 'wolfram-engine'
    fi
else
    # First we need to check for an internet connection
    is_internet
    if [ $? -ne 0 ]; then
	typewriter_echo 'You need to be connected to the internet to install Wolfram.' 0 1
    else
    	# We need at least 850MB of free space
    	FreeSpace=`df -P | grep -v "Available" | awk '{print $4}' | head -n1`
    	if [ $FreeSpace -le 850000 ]; then
            typewriter_echo "You don't have enough available space, ~850MB required." 0 1
            typewriter_echo "Please run Updater in Apps." 0 2
        else
            # Check if wolfram-engine is already installed
            dpkg -s wolfram-engine > /dev/null 2> /dev/null
            if [ $? -eq 1 ]; then
                # Install wolfram
                sudo apt-get install wolfram-engine
                if [ $? -eq 0 ]; then
                    # Installed successfully
                    clear
                    typewriter_echo "Congratulations, Wolfram has been installed successfully." 0 1
                    typewriter_echo "Go to Apps and click on Wolfram or Mathematika to use it." 0 2
                fi
            else
                typewriter_echo "Wolfram is already installed in your Kanux system" 0 2
            fi
        fi
    fi
fi

echo -n "Press [ENTER] to continue"
read dummy

nohup kano-apps 2>/dev/null >/dev/null & >/dev/null
sleep 5
